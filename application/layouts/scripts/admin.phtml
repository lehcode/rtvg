<?php
/**
 * Administrator control panel layout
 * 
 * @author     Antony Repin
 * @subpackage backend
 * @version    $Id: admin.phtml,v 1.10 2013-03-16 20:03:36 developer Exp $
 *
 */
$this->headMeta()->appendHttpEquiv('Content-Type', 'text/html;charset=utf-8'); 
$this->headScript()->setAllowArbitraryAttributes(true);
$this->jQuery()
	->enable()
	->setVersion('1.8.3')
	->setUiVersion('1.8.18')
	->addStylesheet('https://ajax.googleapis.com/ajax/libs/jqueryui/1.8/themes/ui-lightness/jquery-ui.css')
	->uiEnable();

$this->headLink( array('rel'=>'stylesheet/less', 'href'=>$this->baseUrl('css/template.less')), 'APPEND');

$request    = Zend_Controller_Front::getInstance()->getRequest();
$controller = $request->getControllerName();

/*
 * #### Header ####
*/
//$this->navigation()->setDefaultProxy('navigationMenu');
//$this->navigation()->findHelper('navigationMenu')->menu()->setMaxDepth(2);
try {
	$this->placeholder('header')->set( $this->partial('partials/admin/header.phtml', array(
		'mainmenu'=>Zend_Registry::get('AdminMenu'),
		'user'=>$this->user,
	)));
} catch (Exception $e) {
    throw new Zend_Exception( $e->getMessage(), $e->getCode() );
}

if (APPLICATION_ENV=='development'){
	//var_dump($this->user);
	//die(__FILE__.': '.__LINE__);
}


?>
<?php echo $this->doctype(); ?>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ru" lang="ru">
<head>
<?php 
echo $this->headMeta();
echo $this->headTitle();
echo $this->jQuery();
echo $this->headLink();
echo $this->headStyle();
echo $this->headScript();
?>
</head>
<body>
<div class="container">
<?php 
// Messages
if (count($this->messages)) {
	foreach ($this->messages as $text) {
		if (is_array($text)) {
			foreach ($text as $string) {
				echo $this->showMessage( $string );
			}
		} else {
			echo $this->showMessage( $text );
		}
	}
}
?>

<?php 
if ($this->isAllowed('admin:auth') && $this->user['role']!='guest') {
	
	echo $this->placeholder('header');
	
	$forbiddenRoles = array(
		Xmltv_Model_Acl::ROLE_GUEST,
		Xmltv_Model_Acl::ROLE_USER,
		Xmltv_Model_Acl::ROLE_PUBLISHER,
		Xmltv_Model_Acl::ROLE_EDITOR,
	);
	if (!in_array($this->user->role, $forbiddenRoles)) {
		?>
<h6>
	APPLICATION_ENV: <?php echo APPLICATION_ENV ?><br />
	memory_limit: <?php echo ini_get('memory_limit') ?><br />
	error_reporting: <?php echo ini_get('error_reporting') ?><br />
	display_errors: <?php echo ini_get('display_errors') ?><br />
</h6>
		<?php 
	}
} 
?>

<?php 
if ($this->user->role!='guest'){
	echo $this->user->display_name.': ['.$this->user->role.']'; 
}?>

<?php if ($this->isAllowed('admin:auth') && $this->user['role']=='guest') { ?>
<div class="span12">
	<?php echo $this->layout()->content; ?>
</div>
<?php } ?>
</div>
<?php echo $this->inlineScript(); ?>
</body>
</html>