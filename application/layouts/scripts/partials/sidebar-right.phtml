<?php 
/**
 * Right sidebar view script
 * 
 * @author  Antony Repin
 * @package rutvgid
 * @version $Id: sidebar-right.phtml,v 1.10 2013-03-10 02:45:15 developer Exp $
 *
 */
?>

<?php /*
<div class="module">
	<h4>Поиск по сайту</h4>
	<gcse:searchbox></gcse:searchbox>
</div>
*/ ?>

<div class="module">
	<div style="width: 300px; margin: 0 auto; border: 1px solid #999999;">
		<!-- admitad.banner: 8473ea334743631d2075c3fe9ec496 Wizards World -->
		<a target="_blank" rel="nofollow" href="http://ad.admitad.com/goto/8473ea334743631d2075c3fe9ec496/">
			<img width="300" height="250" border="0" src="http://ad.admitad.com/b/8473ea334743631d2075c3fe9ec496/" alt="Wizards World" />
		</a>
		<!-- /admitad.banner -->
	</div>
</div>

<?php
if (count($this->videos) && $this->videos!==false) {
    
    if (APPLICATION_ENV=='development'){
    	//var_dump($this->videos);
    	//die(__FILE__.': '.__LINE__);
    }
    
    $channelTitle = $this->escape($this->channel['title']);
	$this->headScript()->appendScript( Rtvg_Compressor_JSMin::minify("$(function() { 
	var icons = { header: 'ui-icon-circle-arrow-e', activeHeader: 'ui-icon-circle-arrow-s' };
	$( '#col_r .videos_sidebar' ).accordion({
		header: 'h4',
		clearStyle: true,
		collapsible: true,
		active: 0,
		icons:{
			'header': 'ui-icon-plus',
			'headerSelected': 'ui-icon-minus',
		}
	}); });"));
	?>
	
	<div class="module">
	
		<h3 class="mediumheading">Онлайн-видео <?php echo $channelTitle ?></h3>
		
		<div class="videos_sidebar">
		<?php 
		
		foreach ($this->videos as $video) {
			
		    if (APPLICATION_ENV=='development'){
		        //var_dump($video);
		        //die(__FILE__.': '.__LINE__);
		    }
		    
		    $videoTitle = $this->escape( $this->truncateString( $video['title'], 38, 'letters' )); 
		    $videoAlias = $this->escape( $video['alias'] );
		    $videoPublished = $video['published']->toString( 'd MMMM YYYY');
		    $videoDuration  = $video['duration']->toString( 'MM мин ss сек');
		    $videoDesc = $this->escape( $video['desc'] );
		    $linkTitle = empty($video['desc']) ? $videoTitle. $this->truncateString( $videoDesc, 40, 'letters') : $videoTitle ;
		    $linkHref = $this->url(array('alias'=>$videoAlias, 'id'=>$video['rtvg_id']), 'default_videos_show-video');
		    $thumb = $video['thumbs'][rand( 0, count( $video['thumbs'])-1)];
		    
		    ?>
		    
			<h4><i class="icon-plus icon-white"></i><?php echo $videoTitle; ?></h4>
			
			<div class="info">
				
				<p class="viewcount">
					Понравилось <?php echo (int)$video['views']; ?> посетителям
				</p>
				
				<a href="<?php echo $linkHref; ?>" title="Клик чтобы смотреть видео <?php echo $linkTitle; ?>" target="_blank">
					<img src="<?php echo $thumb['url']; ?>" alt="<?php echo $linkTitle; ?>" />
				</a>
				
				<a class="btn btn-inverse btn-mini" href="<?php echo $linkHref; ?>" title="<?php echo $linkTitle; ?> видео" target="_blank">
					Смотреть
				</a>
				
				<div class="date">
					Загружено: <?php echo $videoPublished; ?>
				</div>
				
				<div class="duration">
					Длительность: <?php echo $videoDuration; ?>
				</div>
				
				<?php  if (!empty($video['desc'])): ?>
				<p class="desc">
					<?php 
					$desc = $this->truncateString( $videoDesc, 30, 'words') ; 
					if (stristr($desc, $this->channel['title'])) {
						$channelHref = '<a href="'.$this->url(array('channel'=>$this->channel['alias']), 'default_listings_day-listing') . '" 
							target="_blank" 
							title="Программа канала '.$this->channel['title'].'">'.$this->channel['title'].'</a>';
						echo Xmltv_String::str_ireplace($this->channel['title'], $channelHref, $desc); 
					}
					echo $desc;
					?>
				</p>
				<?php endif; ?>
				
			</div> 
		<?php 
		
		}
		?>
			
	</div>
</div>
		<?php 		
	
	?>
	
<?php 
}

$this->inlineScript()->appendScript("$(document).ready(function(){ $('#rumor-ads').css({ display: 'block' }); });");
?>
<div class="module" id="rumor-ads">
	<?php /*<h4 class="mediumheading">Желтая пресса</h4>*/ ?>
	<div class="content" id="DIV_DA_85753"></div>
</div>


<?php 
/*
$this->headScript()
	->appendFile( $this->baseUrl('js/tmedia.js'));
$this->inlineScript()
	->appendScript("$(document).ready(function(){ $('#tmedia').css({ display: 'block' }); });"); 
?>
<div class="module" id="tmedia">
	<script type="text/javascript">
	var tm_adsblock=6873;
	var tm_site_id=5630;
	</script>
	<script type="text/javascript" src="http://tm.rutvgid.ru/main.html"></script>
</div>
*/ ?>


<div class="module">
	<h5 class="mediumheading">Телепрограмма vkontakte</h5>
	<div id="vk_groups"></div>
</div>


<?php /*
<div class="module" style="width: 240px; margin: 0 auto;">
	<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,28,0" width="240" height="400">
	<param name="movie" value="http://invest-system.net/banners/invest2_240x400.swf" />
	<param name="flashvars" value="isLink=http://invest-system.net/partner/113132">
	<param name="quality" value="high" />
	<param name="wmode" value="transparent"/>
	<embed src="http://invest-system.net/banners/invest2_240x400.swf" wmode="transparent" quality="high" flashvars="isLink=http://invest-system.net/partner/113132" wmode="transparent" pluginspage="http://adobe.com/shockwave/download/download.cgi?P1_Prod_Version=ShockwaveFlash" type="application/x-shockwave-flash" width="240" height="400">
	</embed>
	</object>
</div>
*/ ?>

<div class="module">
	<div style="width: 300px; margin: 0 auto; border: 1px solid #999999;">
		<a target="_blank" rel="nofollow" href="http://ad.admitad.com/goto/e602fa22d543631d2075d908a9ba75/">
		<img width="300" height="250" border="0" src="http://ad.admitad.com/b/e602fa22d543631d2075d908a9ba75/" alt="Boutique - RU" /></a>
	</div>
</div>