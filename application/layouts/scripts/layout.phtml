<?php
/**
 * Common layout
 * 
 * @author  Antony Repin
 * @package rutvgid
 * @version $Id: layout.phtml,v 1.17 2012-12-25 02:14:18 developer Exp $
 *
 */

$this->headMeta()
	->prependHttpEquiv('Content-Type', 'text/html;charset=utf-8');

//$this->headLink( array('rel'=>'stylesheet/less', 'href'=>$this->baseUrl('css/base.less')), 'APPEND');
$this->headLink( array('rel'=>'stylesheet/less', 'href'=>$this->baseUrl('css/template.less')), 'APPEND');
$this->headLink( array('rel'=>'stylesheet/less', 'href'=>$this->baseUrl('css/animations.less')), 'APPEND');
$this->headLink()
	->prependStylesheet( $this->baseUrl('css/base.css'))
	->prependStylesheet( 'http://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css')
	->appendStylesheet($this->baseUrl('css/fonts.css'))
	->appendStylesheet($this->baseUrl('js/tip/jquery.tooltip.css'));

/*
 * Check browser
 */
$browser = $this->userAgent()->getUserAgent();
$browserMsie = false;
if (strstr($browser, 'MSIE')) {
	$browserMsie = true;
	$this->headLink()
		->appendStylesheet($this->baseUrl('css/ie.css'))
		->appendStylesheet($this->baseUrl('css/fonts-ie.css'));
}

$this->headTitle()
	->setSeparator(' :: ');


$this->jQuery()->enable() //enable jquery ;
	//->setCdnSsl(true) if need to load from ssl location
	->setVersion('1.7.1') //jQuery version, automatically 1.5 = 1.5.latest
	->setUiVersion('1.8.18') //jQuery UI version, automatically 1.8 = 1.8.latest
	->uiEnable();

$this->headScript()
	->setAllowArbitraryAttributes(true)
	->prependFile($this->baseUrl($this->baseUrl('js/less.min.js')))
	//->prependFile($this->baseUrl('js/forms/vklogin.js'))
	->prependFile($this->baseUrl('js/bootstrap.js'))
	->appendFile('http://yandex.st/share/share.js' )
	->appendFile('http://userapi.com/js/api/openapi.js?50' )
	->appendScript( 'VK.init({ apiId: 2963750, onlyWidgets: true}); 
	jQuery(document).ready(function(){ 
		$("#footer .counter_logo").hide(); if  ($(".da_adp_links")) $(".da_adp_links").hide();
	});');


if (APPLICATION_ENV=='production') {
	$googleCounter = "var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-778789-8']);
	  _gaq.push(['_trackPageview']);
	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	";
	$liCounter = 'new Image().src = "//counter.yadro.ru/hit?r"+
	escape(document.referrer)+((typeof(screen)=="undefined")?"":
	";s"+screen.width+"*"+screen.height+"*"+(screen.colorDepth?
	screen.colorDepth:screen.pixelDepth))+";u"+escape(document.URL)+
	";h"+escape(document.title.substring(0,80))+
	";"+Math.random();';
	$this->headScript()
		->appendScript($googleCounter."\n".$liCounter);
}

$this->maincontent_width = 6;
if ($this->hide_sidebar=='left'){
	$this->maincontent_width = 8;
}
if ($this->hide_sidebar=='right'){
	$this->maincontent_width = 10;
}

try {
	
	$this->placeholder('maincontent')->set( $this->layout()->content );
	$this->placeholder('header')->set( $this->partial('partials/header.phtml', array('pageclass'=>$this->pageclass)) );
	$this->placeholder('footer')->set( $this->partial('partials/footer.phtml', array()) );
	$this->placeholder('featured_channels')->set( $this->partial('partials/featured-channels.phtml', array()) );
	$this->placeholder('sidebar_left')->set( $this->partial('partials/sidebar-left.phtml', array(
		'top_programs'=>$this->top_programs,
		'cats'=>$this->channels_cats,
		'channel'=>$this->channel )));
	
	if ($this->is_frontpage) {
		$this->placeholder('frontpage_menu')->set( $this->partial('partials/frontpage-menu.phtml', array()) );
	}
	
	/*
	 * right sidebar
	 */
	$sidebarConf = array(
		'videos'=>$this->sidebar_videos,
		'kids_channels'=>$this->kids_channels,
		'show_videos'=>$this->show_videos,
	);
	if ($this->channel) $sidebarConf['channel'] = $this->channel;
	if ($this->current_program) $sidebarConf['program'] = $this->current_program;
	$this->placeholder('sidebar_right')->set( $this->partial( 'partials/sidebar-right.phtml', $sidebarConf ) );
	
} catch (Exception $e) {
	throw new Zend_Exception($e->getMessage(), $e->getCode());
}

//$fpMenu = $this->fpMenu();
//$footer = $this->footer();

?>

<?php echo $this->doctype(); ?>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:og="http://ogp.me/ns#" xml:lang="ru" lang="ru">
<head>
<?php 

echo $this->headTitle(), PHP_EOL;
echo $this->headMeta(), PHP_EOL;
echo $this->jQuery();
echo $this->headLink(), PHP_EOL;
echo $this->headScript(), PHP_EOL;
echo $this->headStyle(), PHP_EOL;

$this->inlineScript()
	->appendScript("(function() {
	var cx = '006142482445578005725:vkbnaloj-g8';
	var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
	gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
		'//www.google.com/cse/cse.js?cx=' + cx;
	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
  })();");

if (!$this->is_frontpage) {
	$this->inlineScript()
		->appendFile("http://www.directadvert.ru/show.cgi?adp=85753&div=DIV_DA_85753");  //directadvert right sidebar
	
	if (APPLICATION_ENV!='development') {
		$this->inlineScript()
			->appendFile("http://www.adcash.com/script/java.php?option=rotateur&rotateur=102755") //adcash rollin
			->appendFile("http://rotation-media.net/codes/21010/40198_rutvgid.ru.js")  //mediarich adspot
			->appendFile("http://rotationmessage.net/codes/21010/40198_rutvgid.ru.js"); //mediarich vk message
	}
}

?>
<script>
(function() {
	var cx = '006142482445578005725:vkbnaloj-g8';
	var gcse = document.createElement('script'); gcse.type = 'text/javascript'; gcse.async = true;
	gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//www.google.com/cse/cse.js?cx=' + cx;
	var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(gcse, s);
})();
</script>
<script language='javascript' type='text/javascript' src='http://ppp.rutvgid.ru/80j4ch2sa3g5s46cexqrro13ejeo0t3p'></script>
</head>
<body>
	
	<?php if (!$this->is_frontpage): ?>
	<div class="row-fluid" id="header">
		<?php echo $this->placeholder('header'); ?>
	</div>
	<?php endif; ?>
	
	<div class="row-fluid content<?php echo isset($this->pageclass) && !empty($this->pageclass) ? ' '.$this->pageclass : '' ; ?>">
		
		<?php 
		if ($this->is_frontpage) { 
			?>
		<div class="span12" id="maincontent">
			<?php echo $this->placeholder('frontpage_menu'); ?>
			<?php /*
			<div class="span12" id="premieres">
				<?php echo $premieres; ?>
			</div>
			*/ ?>
		</div>
			<?php 
		} else {
			 ?>
		
		<?php if (!($this->hide_sidebar=='left')): ?>
		<div class="span2" id="col_l">
			<?php echo $this->placeholder('sidebar_left'); ?>
		</div>
		<?php endif; ?>
		
		<div class="span<?php echo $this->maincontent_width.' '.$this->pageclass ?>" id="maincontent">
			
			<?php 
			if (count($this->messages)) {
				foreach ($this->messages as $text) {
					if (is_array($text)) {
						foreach ($text as $string)
							echo $this->showMessage( $string );
					} else echo $this->showMessage( $text );
				}
			} else {
				if (APPLICATION_ENV=='production') {
					?>
					<div id="DIV_DA_85979"></div><?php //directadvert rollin left ?>
					<?php 
				}
			}
			echo $this->placeholder('maincontent');
			
			?>
			
		</div>
				
		<?php if (!($this->hide_sidebar=='right')): ?>
		<div class="span4" id="col_r">
			<?php echo $this->placeholder('sidebar_right'); ?>
		</div>
		<?php endif; ?>
		
		<?php 
		} ?>
		
	</div>
	
	<div id="featuredchannels" class="row-fluid">
		<?php echo $this->placeholder('featured_channels'); ?>
	</div>
	
	<div class="row-fluid" id="footer">
		<?php echo $this->placeholder('footer'); ?>
	</div>


<?php echo $this->inlineScript(); ?>

<?php 
if (APPLICATION_ENV=='production'){
?>
<!-- Yandex.Metrika counter -->
<script type="text/javascript">
(function (d, w, c) {
    (w[c] = w[c] || []).push(function() {
        try {
            w.yaCounter16053280 = new Ya.Metrika({id:16053280, enableAll: true, webvisor:true});
        } catch(e) {}
    });
    
    var n = d.getElementsByTagName("script")[0],
        s = d.createElement("script"),
        f = function () { n.parentNode.insertBefore(s, n); };
    s.type = "text/javascript";
    s.async = true;
    s.src = (d.location.protocol == "https:" ? "https:" : "http:") + "//mc.yandex.ru/metrika/watch.js";

    if (w.opera == "[object Opera]") {
        d.addEventListener("DOMContentLoaded", f);
    } else { f(); }
})(document, window, "yandex_metrika_callbacks");
</script>
<noscript><div><img src="//mc.yandex.ru/watch/16053280" style="position:absolute; left:-9999px;" alt="" /></div></noscript>
<!-- /Yandex.Metrika counter -->
<?php 
}
?>
 
<?php echo $this->inlineScript(); ?>
</body>
</html>