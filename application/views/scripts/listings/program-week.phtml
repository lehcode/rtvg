	<?php
/**
 * Программа на неделе
 * 
 * @author  Antony Repin
 * @package rutvgid
 * @version $Id: program-week.phtml,v 1.11 2013-01-02 05:07:50 developer Exp $
 *
 */

$programTitle = $this->list[0]->title;
$programAlias = $this->escape( $this->list[0]->alias );
$channelTitle = isset($this->channel->title) ? $this->escape( $this->channel->title ) : null ;
$channelAlias = isset($this->channel->alias) ? $this->escape( $this->channel->alias ): null ;

if ($programTitle){
	$this->headMeta()->setName( 'title', "$programTitle, $channelTitle" );
	$this->headTitle( $this->escape( sprintf ('Программа «%s» на этой неделе на канале %s :: rutvgid.ru', $programTitle, $channelTitle )));
}
?>

<?php /*
<div id="fast_search">
	<?php
	$form = new Xmltv_Form_FastChannelSearchForm();
	echo $form;
	?>
</div>
*/ ?>

<div class="yashare-auto-init" data-yashareL10n="ru" data-yashareType="button" data-yashareQuickServices="vkontakte,facebook,twitter,odnoklassniki,moimir,moikrug,gplus,surfingbird"></div>

<h1>
	<?php if ($programTitle) : ?>
	<?php echo $this->escape( '«'.$programTitle.'»' ); ?> на канале <?php echo $channelTitle ?>
	<?php else : ?>
	Результаты поиска программы
	<?php endif; ?>
</h1>

<p>
	<?php echo Xmltv_String::ucfirst( $this->week_start->toString('EEEE, d MMMM') ) ?> - <?php echo Xmltv_String::ucfirst( $this->week_end->toString('EEEE, d MMMM') ); ?>
</p>

<h2>
	<?php /*
	<a href="<?php echo $this->url( array('channel'=>$channelAlias), 'default_listings_day-listing' ) ?>" 
		title="Телепрограмма <?php echo $channelTitle ?> на <?php echo $this->escape($this->program->start->toString('d MMM YYYY')) ?>">
		Программа передач <?php echo $channelTitle; ?> сегодня
	</a>
	*/ ?>
</h2>


<?php  
if (!@$this->notfound) {
?>

<?php
	foreach ($this->list as $single) {
	    
		$program_start = new Zend_Date($single->start, 'YYYY-MM-dd HH:mm:ss' );
		//var_dump($single);
		//die(__FILE__.': '.__LINE__);
		?>
		
		<p>
			<?php $date = new Zend_Date($single->start, 'YYYY-MM-dd HH:mm:ss' ); ?>
			<span class="label"><?php echo $program_start->toString( 'dd MMMM') ?></span>&nbsp;<span class="label label-info"><?php echo $program_start->toString( 'HH:mm') ?></span> 
			<a href="<?php echo $this->url( array('channel'=>$single->channel_alias, 'date'=>$program_start->toString("dd-MM-yyyy")), 'default_listings_day-date' ).'?ts='.$program_start->toString("U") ?>"
				title="<?php echo $single->title ?> <?php echo $program_start->toString( 'dd MMM') ?> на канале <?php echo $single->channel_title; ?>"
				target="_blank">
				<?php echo $single->title ?>
			</a> на канале <a href="<?php echo $this->url( array( 'channel'=>$single->channel_alias ), 'default_listings_day-listing' ) ?>"><?php echo $single->channel_title ?></a>
		</p>
	<?php 
	}
	?>
	
	
	<h3>Похожие программы в другое время на этой неделе</h3>
	<?php 
	if (isset($this->similar)) {
	    foreach ($this->similar as $single) {
	        $channelIcon = $this->baseUrl('images/channel_logo/'.$single->channel_icon);
	        $date = new Zend_Date($single->start, 'YYYY-MM-dd HH:mm:ss' );
			?>
		<p>
			<img src="<?php echo $channelIcon ?>" alt="<?php echo $single->channel_title ?>" />
			<span class="label"><?php echo $program_start->toString( 'dd MMMM') ?></span>&nbsp;<span class="label label-info"><?php echo $program_start->toString( 'HH:mm') ?></span> 
			<a href="<?php echo $this->url( array('channel'=>$single->channel_alias, 'date'=>$program_start->toString("dd-MM-yyyy")), 'default_listings_day-date' ).'?ts='.$program_start->toString("U") ?>"
				title="<?php echo $single->title ?> <?php echo $program_start->toString( 'dd MMM') ?> на канале <?php echo $single->channel_title; ?>"
				target="_blank">
				<?php echo $single->title ?>
			</a> на канале <a href="<?php echo $this->url( array( 'channel'=>$single->channel_alias ), 'default_listings_day-listing' ) ?>"><?php echo $single->channel_title ?></a>
		</p>
			<?php 
	    }
	}
	?>
	
<?php
} else {
    ?>
    
    <p>
		На этой неделе программу <em><?php echo $programTitle ?></em> показывать позже не будут. Но мы нашли похожие программы, которые возможно вас заинтересуют.
	</p>
	
	<?php 
	if (isset($this->similar)) {
	    foreach ($this->similar as $single) {
	        ?>
		<p>
			<?php $date = new Zend_Date($single->start, 'YYYY-MM-dd HH:mm:ss' ); ?>
			<span class="label"><?php echo $date->toString( 'dd MMMM') ?></span>&nbsp;
			<span class="label label-info"><?php echo $date->toString( 'HH:mm') ?></span> 
			<a href="<?php echo $this->url( array('channel'=>$single->channel_alias, 'date'=>$date->toString("dd-MM-yyyy")), 'default_listings_day-date' ) ?>"
				title="<?php echo $single->title ?> <?php echo $single->start->toString( 'dd MMM') ?> на канале <?php echo $single->channel_title; ?>"
				target="_blank">
				<?php echo $single->title ?>
			</a> на канале <a href="<?php echo $this->url( array( 'channel'=>$single->channel_alias ), 'default_listings_day-listing' ) ?>"><?php echo $single->channel_title ?></a>
		</p>
		<?php 
	    }
	}
	?>
    
    
	
	<?php 
	
}
?>

 

