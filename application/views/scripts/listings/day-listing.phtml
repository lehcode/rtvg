<?php 
/**
 * Day listing script for channel
 * 
 * @author  Antony Repin
 * @package rutvgid
 * @version $Id: day-listing.phtml,v 1.32 2013-04-11 05:21:11 developer Exp $
 *
 */

$channelTitle = $this->escape( $this->channel['title'] );
$channelAlias = $this->escape( $this->channel['alias'] );

$this->headMeta()->setName('title', sprintf ('«%s» онлайн в отличной качестве', $channelTitle ));
$this->headMeta()->setName('description', sprintf ('Телепрограмма канала «%s» на сегодня', $channelTitle ));

$js = "$(function(){
	var minHeight = 0;
	$('#programlist .item').each(function(){
		var p      = $(this).find('p.description');
		$(this).find('.inner').append($('<a/>').attr({ 'href':'#' }).html('Полностью'));
		var height = $(this).height();
		if (height<minHeight){
			minHeight = height;
		}
	});
	console.log(minHeight);
});";
$js = (APPLICATION_ENV=='production') ? Rtvg_Compressor_JSMin::minify($js): $js ;
$this->headScript()->appendScript($js);


$css="#content.day-listing .top form {
	margin: 0;
}
";
$this->headStyle()->appendStyle($css);

?>

<div class="row">
    <h1>&laquo;<?= $channelTitle ?>&raquo; 
        <time itemprop="startDate" datetime="<?= $this->listing_date->toString(Zend_Date::ISO_8601) ?>">
            <?= Xmltv_String::ucfirst( $this->listing_date->toString("EEEE, d MMMM YYYY") ); ?>
        </time>
    </h1>
</div>



<div class="top row">
    
	<span class="span4" id="timer">Сейчас <?php echo $this->listing_date->toString("HH:mm") ?> (MSK)</span>
    
    <?php 
    try {
        $linkAttrHref  = $this->url(array('channel'=>$channelAlias), 'default_listings_day-listing');
    } catch (Exception $e) {
        throw new Zend_Exception("Cannot assemble URL", 500, $e);
    }
    $linkAttrTitle = $this->escape( sprintf('Телепрограмма «%s» на сегодня', $channelTitle) );
    $linkText = sprintf ('«%s» сегодня', $channelTitle);
    ?>
	<h2 class="span4">
		<a href="<?php echo $linkAttrHref; ?>" 
           title="<?php echo $linkAttrTitle; ?>" 
           class="btn btn-mini btn-info">
               <?php echo $linkText; ?>
        </a>
	</h2>
	
    
    <h3 class="span4 weekLink">
		<?php 
        try {
            $linkAttrHref  = $this->url( array('channel'=>$channelAlias), 'default_channels_channel-week' );
        } catch (Exception $e) {
            throw new Zend_Exception("Cannot assemble URL", 500, $e);
        }
        $linkAttrTitle = $this->escape( sprintf('Передачи %s', $channelTitle) );
		$linkText      = $this->escape( sprintf ('Программа на неделю', $channelTitle) );
		?>
		<a href="<?php echo $linkAttrHref; ?>" 
           title="<?php echo $linkAttrTitle; ?>" 
           class="btn btn-mini btn-info">
			<?php echo $linkText; ?>
		</a>
	</h3>
    
</div>

<div class="row">
	<?php
	//$this->headScript()->appendScript("$(function(){ $('#DIV_DA_78318 table').hide(); });");
	?>
	<div id="DIV_DA_78318"></div>
	
    <?php 
    //if ((int)$this->channel['stream'] > 0){
        $siteId = (APPLICATION_ENV=='production') ? 762 : 923 ; 
        echo $this->aceStream($siteId, (int)$this->channel['stream'], 580, 326);
    //} ?>
</div>



<?php 
if (count($this->programs)){
    if ($this->is_today) {
        echo $this->partial( 'listings/partials/programlist.phtml', array( 
            'items'          => $this->programs, 
            'channel'        => $this->channel, 
            'listing_videos' => $this->listing_videos, 
            'is_today'       => $this->is_today, 
            'short_link'     => $this->short_link,
            'listing_date'   => $this->listing_date,
        )); 
    } else {
        echo $this->partial( 'listings/partials/programtable.phtml', array(
            'items'        => $this->programs,
            'channel'      => $this->channel,
            'listing_date' => $this->listing_date,
        ));
    }
}
?>

<div class="row">
    <p class="ace">Для просмотра телеканала &laquo;<?= $this->channel['title'] ?>&raquo; с помощью <em>Торрент-ТВ в отличном качестве</em> вам нужно
        скачать и установить специальный плагин <a href="http://acestream.org/ru/" target="blank" rel="nofollow" title="Скачать Торрент ТВ">Ace Stream</a>.
        Установка занимает минуту. После того как плагин <em>Торрент-ТВ</em> установлен, перезапустите свой браузер. Смотрите - хоть обсмотритесь :)
    </p>
</div>

