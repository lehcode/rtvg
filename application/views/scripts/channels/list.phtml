<?php 
/**
 * View script for channel list
 * or channel category list
 * 
 * @author  Antony Repin
 * @package rutvgid
 * @version $Id: list.phtml,v 1.12 2013-01-02 05:07:50 developer Exp $
 *
 */

if (!$this->category) {
	$this->headTitle( 'Программа всех каналов телевидения на сегодня и текущую неделю.' );
	$this->headMeta()->setName('title', 'Телепрограмма всех каналов');
} else {
    $this->headTitle( $this->category['title'].': телепрограмма на сегодня и текущую неделю.' );
    $this->headMeta()->setName('title', 'Телепрограмма '.$this->category['title'].' каналов');
}


/**
 * Load scripts
 */
$this->headScript()
	->prependScript("$(function(){
		$('#fastsearch-wrap a').tooltip({
			showURL: false
		});});")
	->prependFile( $this->baseUrl('js/channellist.js'));
	

$this->headStyle()
	->appendStyle('p.channeltitle { margin: 0 0 12px; }
	#fastsearch-wrap { width: 100%; float: none; }');


if (APPLICATION_ENV=='development') {
	$this->headScript()->appendFile( $this->baseUrl('js/tip/jquery.tooltip.js'));
} else {
	$this->headScript()->appendFile( $this->baseUrl('js/tip/jquery.tooltip.min.js'));
}

?>


<?php 
/*
if (!$this->category) {
	?>
<div id="fastsearch-wrap">
	<label for="channel_filter" class="mediumheading">Быстрый переход</label>
	<input type="text" name="fast_search" data-provide="typeahead" />
	<a href="#" title="Начните вводить название канала и выберите его из списка. Окно браузера автоматически переместится к выбранному каналу.">
		<img src="/images/icons/tip-12x12.gif" />
	</a>
</div>
	<?php 
} else {
	?>
<div id="fastsearch-wrap">
	<?php 
	$form = new Xmltv_Form_FastChannelSearchForm(); 
	echo $form; 
	?>
	<a href="#" title="Начните вводить название канала и выберите его из списка. Окно браузера автоматически переместится к выбранному каналу. Если этого не произошло, значит канал находится в другом разделе. Просто нажмите кнопку Перейти.">
		<img src="/images/icons/tip-12x12.gif" />
	</a>
</div>
	<?php 
} 
*/ ?>

	
<?php if (isset($this->category) && $this->category!==null): ?>
<?php //var_dump($this->category) ?>
<h2>
	<?php /*img src="<?php echo $this->baseUrl('images/categories/channels/'.$this->escape( $this->category['image']) ); ?>" />*/ ?>
	<?php echo $this->category['title']; ?> каналы
</h2>
<?php endif; ?>

<?php if (isset($this->category) && $this->category!==null): ?>
<p class="label label-info">
	<?php echo count($this->channels); ?> телеканала в категории <?php echo $this->escape( '«'.$this->category['title'].'»' ) ?>
</p>
<?php else: ?>
<p class="label label-info">
	Всего <?php echo count($this->channels); ?>
</p>
<?php endif; ?>


<div id="channels">

	<?php
	foreach ($this->channels as $channel) { 
		$id    = $channel['ch_id'];
		$title = $channel['title'];
		$alias = $channel['alias'];
		$icon  = $channel['icon'];
		?>
	
	<h3 class="channeltitle" id="#channeltitle<?php echo $id ?>">
		<img class="channelicon" 
			width="40" 
			src="<?php echo $icon; ?>" 
			alt="<?php printf('%s лого', Xmltv_String::strtolower($title)) ?>" />
		<?php echo $channel['title'] ?>
	</h3>
	
	<div class="channeldesc">
		<a class="label label-important" 
			href="<?php echo $this->url(array('channel'=>Xmltv_String::strtolower($alias)), 'default_listings_day-listing'); ?>" 
			title="<?php printf('Телепрограмма канала %s на сегодня', $title) ?>">
			Программа на сегодня
		</a>
		<a class="label label-info" 
			href="<?php echo $this->url(array('channel'=>Xmltv_String::strtolower($alias)), 'default_channels_channel-week'); ?>" 
			title="<?php printf('Телепрограмма канала %s на неделю', $channel['title']) ?>">
			Программа на неделю
		</a>
		
		<p>
			<?php echo $this->escape( strip_tags($channel['desc_intro']) ) ?>
		</p>
		<p>
			<?php echo $this->truncateString( strip_tags($channel['desc_body']), 20, 'words'); ?>
		</p>
	</div>

	<?php 
	}
	?>
</div>
