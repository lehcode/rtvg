<?php
/**
 * Video page view script
 * 
 * @author  Antony Repin
 * @package rutvgid
 * @version $Id: show-video.phtml,v 1.22 2013-04-06 22:35:04 developer Exp $
 *
 */

if (isset($this->main_video)){
    
    $videoTitle = Xmltv_String::ucfirst( Xmltv_String::strtolower( $this->main_video['title'] ));
    $this->headTitle( sprintf("Видео «%s» :: онлайн на rutvgid.ru", $videoTitle));
    
    $videoDesc = $this->main_video['desc'];
    if ($videoDesc) {
    	$this->headMeta()->setName( 'description', $this->truncateString( str_replace( "\n", ' ', $videoDesc), 12, 'words'));
    }
    
    $this->inlineScript()
    	->appendFile("/js/swfobject/swfobject.js");
    /*
    $this->headScript()->appendScript( Rtvg_Compressor_JSMin::minify("$(document).ready(function() {
    		var descP = $('.video.thumbnails p.desc');
    		var descHeight = descP.prop('offsetHeight');
    		if (descHeight>150) { descP.css({ height:'8.4em' }).after('<button class=\"btn\" id=\"fulldesc\">Читать полностью</a>'); }
    		$('#fulldesc').click( function(e){ descP.css({ height:descHeight }); $(this).hide(500); });
    		$('#maincontent div.videos div.main div.player-wrap').val('');
    
    });"));
     * */
    ?>
    
<div class="page videos">

	<div class="video main">
	
		<h1><?php echo $videoTitle ?></h1>
		
		<div class="player-wrap">
			<div id="player">Для просмотра этого видео нужна поддержка Flash player 8+ и JavaScript в вашем браузере.</div>
		</div>
		<div id="advm_video" data-show-time="15"></div>
		
		<p class="desc"><?php echo strip_tags( $videoDesc ) ?></p>
		
		<?php 
		$this->inlineScript()->appendScript('var params = { allowScriptAccess: "always", allowfullscreen:"true", wmode:"transparent" };
	    var attrs = { id: "mytplayer" };
	    swfobject.embedSWF("http://www.youtube.com/v/'.$this->main_video['yt_id'].'?enablejsapi=1&playerapiid=ytplayer&version=3&allowfullscreen=true", "player", "460", "258", "8", null, null, params, attrs);');
		?>
		
	</div>
	
	<div class="related">
	<?php
	$amount=(int)Zend_Registry::get('site_config')->videos->related->get('amt');
	$i=0;
	if (!empty($this->related_videos)) {
	    
	    foreach ($this->related_videos as $v) {
	        
            if (!empty($v['alias'])) {
				?>
			<div class="video">
				
				<h3 class="title">
					<a href="<?php echo $this->url( array('alias'=>$v['alias'], 'id'=>$v['rtvg_id']), 'default_videos_show-video' )  ?>" 
						title="Смотреть онлайн <?php echo $v['title'] ?>" 
						target="_self">
						<?php echo $v['title'] ?>
					</a>
				</h3>
			
				<div class="image" itemscope itemtype="http://schema.org/ImageObject">
					<?php 
					$thumb = $v['thumbs'][mt_rand(0, count($v['thumbs'])-1)];
						?>
					<a href="<?php echo $this->url( array(
						'alias'=>$v['alias'], 
						'id'=>$v['rtvg_id']), 'default_videos_show-video' ) ?>"
						class="imagelink">
						<img src="<?php echo $thumb['url'] ?>" 
							width="160" 
							alt="<?php echo $v['title'] ?>" />
					</a>
					
					<p class="viewcount">Посмотрели: <?php echo number_format( (int)$v['views'], 0 ) ?></p>
					
					<?php if (isset($v['category_ru']) && !empty($v['category_ru'])) { ?>
					<p class="category">
                        <?php
                        $urlHref = $this->url( array(
                            'category'=>Xmltv_String::strtolower( $v['category_ru']['channel_cat_alias'] )), 'default_channels_category');
                        ?>
						Категория: 
						<a href="<?= $urlHref;  ?>"
							target="_self"
							title="<?php printf("%s каналы телепрограмма", $v['category_ru']) ?>">
							<?php echo $v['category_ru']['channel_cat_title']; ?>
						</a>
					</p>
					<?php 
					} ?>
					
					<p class="date">
						<?php 
						$date = new Zend_Date ( $v['published'] ); 
						printf("Добавлено %s", $date->toString('d MMM YYYY'));
						?>
					</p>
					
				</div>
					
				<div class="description">
					<p>
						<?php echo $this->truncateString( $v['desc'], 35, 'words' ) ?>
					</p>
				</div>
				
			</div>
			<?php 
				$i++;
			}
			
		}
		
	} ?>
		
	</div>
	
</div>
    
    <?php 
} else {
    $this->headMeta()->setName( 'description', "Not found!" );
    $this->headMeta()->setName( 'robots', 'noindex,follow' );
}
?>




